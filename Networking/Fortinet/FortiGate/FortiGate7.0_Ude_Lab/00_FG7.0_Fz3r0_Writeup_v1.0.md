# Fz3r0 Operations: `FortiGate 7.0` @ **`El camino al NSE4`**
#### Keywords: `Networking` `Security` `NSE4` `FortiGate` `Fortinet` `Blue Team` `Defensive Security` `Next Generation Firewall` `Routing` `FortIOS` `InfoSec` `GNS3` `LAN` `WAN` `VLAN`

![My Video](https://user-images.githubusercontent.com/94720207/165892585-b830998d-d7c5-43b4-a3ad-f71a07b9077e.gif)
_Writeup by [Fz3r0 💀](https://github.com/Fz3r0/)_

### Contact

- **Github**  : [Fz3r0](https://github.com/fz3r0) 
- **Twitter**  : [@Fz3r0_OPs](https://twitter.com/Fz3r0_OPs) 
- **Youtube**  : [@Fz3r0_OPs](https://www.youtube.com/Fz3r0_OPs) 

## Index 

### FortiGate 7.0 - El camino al NSE4:

- [`Parte 1` - Armando el Lab](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#fortigate-70---parte-1---armando-el-lab)
    - [Configurar GNS3 como Main Server](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#ojo-el-cliente---gns3exe-es-el-ui-ejecutable-del-gns3-el-server---gns3-vm--es-la-pantalla-azul-del-vmware-) 
    - [Importar el Laboratiorio al GNS3](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#importar-el-laboratiorio-al-gns3)
    - [Tomar Snapshot Init](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#tomar-snapshot-init)
    - [Licencia Expirada de FortiGate](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#licencia-expirada-de-fortigate)
- [`Parte 2` - Iniciando por primera vez el FortiGate](https://github.com/Fz3r0/Fz3r0/edit/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#fortigate-70---parte-2---iniciando-por-primera-vez-el-fortigate)
    - [FortiGate Default Settings](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#fortigate-default-settings) 
    - [`Site A` - Init y Configurar script en CLI para acceso Web](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#site-a---initi-y-configurar-script-en-cli-para-acceso-web)
    - [`Site B` - Init y Configurar script en CLI para acceso Web](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#site-b---initi-y-configurar-script-en-cli-para-acceso-web)
    - [Configuraciones Finales de Laboratiorio](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#configuraciones-finales-de-laboratiorio)
    - [Theme, Time, Intro & Gimicks](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#theme-time-intro--gimicks)
    - [Manera Correcta de Apagar Fortigate](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#manera-correcta-de-apagar-fortigate)
    - [Dashboard y Widgets en FortiGate](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#dashboard-y-widgets-en-fortigate)
    - [Revisar Información de FortiGate (Status)](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#revisar-informaci%C3%B3n-de-fortigate-status) <br><br>
        - [**`BONUS!` - `INIT CONFIG` by `Fz3r0 💀`**](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#bonus-configuraci%C3%B3n-del-padrino-fz3r0) 

- [`Parte 3` - Configuración de Interfaces](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#fortigate-70---parte-3---configuraciones-de-interfaces)
    - [Configurar Interface: `Management` [**Static**]](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#configurar-ip-est%C3%A1tica-en-management) 
    - [Configurar Interface: `Management` [**DHCP**]](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#configurar-ip-din%C3%A1mica-dhcp-en-management)
    - [Configurar Interfaces: `WAN`](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#configurar-interfaces-wan)
    - [Configurar `Default Route` / `Static Route`](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#configurando-default-route--static-route)
    - [Configurar Interfaces `LAN`](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#configurar-interfaces-lan) <br><br>
        - [**`BONUS!` - `INTERFACES CONFIG [WAN | LAN | MGMT]` by `Fz3r0 💀`**](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#bonus-configuraci%C3%B3n-del-padrino-fz3r0) 

- [`Parte 4` - Backup, Restore, Revisions & Scripts](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#fortigate-70---parte-4---backup-restore-revisions--scripts)
    - [Backups & Restore](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#backups--restore)
    - [Revisions](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#revisions)

- [`Parte 5` - Backup, Restore, Revisions & Scripts](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#fortigate-70---parte-5---gestionando-users-admins)
    - [`Admin` por Default `super-user` & `prof-user`](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#admin-por-default-super-user--prof-user) 
    - [Crear `User/Admin` y asignarle un `Admin profile`](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#crear-user-y-asignarle-un-perfil-de-admin)<br><br>
        - [**`BONUS!` - `Admin/User creation` by `Fz3r0 💀`**](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#politica-de-internet-by-fz3r0) 

- [`Parte 6` - Policy: `Acceso a Internet`](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#fortigate-70---parte-6---policy-acceso-a-internet)
    - [Creando la Policy: `Acceso a Internet`](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#creando-la-policy-acceso-a-internet) <br><br>
        - [**`BONUS!` - `Internet Access Policy` by `Fz3r0 💀`**](https://github.com/Fz3r0/Fz3r0/blob/main/Networking/Fortinet/FortiGate/FortiGate7.0_Ude_Lab/00_FG7.0_Fz3r0_Writeup_v1.0.md#politica-de-internet-by-fz3r0) 


---

☠️ _"For every lock, there is someone out there trying to pick it or break in."_ ☠️
![image](https://user-images.githubusercontent.com/94720207/215277186-fe5efa49-be69-4b5e-9780-a1ebf98eb040.png)

# FortiGate 7.0 - `Parte 1` - Armando el Lab

## Configurar GNS3 como `Main Server`

#### OJO! El `Cliente - GNS3.exe` es el **UI ejecutable** del GNS3, el `Server - GNS3-VM`  es la pantalla azul del **VMWare** ;)

1. Abrir el `Servidor` GNS3-VM primero desde el VMware hasta llegar a este diálogo.
- Importante que se vean los datos de IP y puerto 80, así como user y pass

![image](https://user-images.githubusercontent.com/94720207/208322267-b66bc5df-a62b-4eb5-91f6-7666a22da4ac.png)

2. Ahora hay que enlazar cliente con servidor: Abrir el `Cliente` y configurar lo siguiente:

![image](https://user-images.githubusercontent.com/94720207/208322556-96a590b2-790b-410f-a7cd-d545acf3c0fa.png)

![image](https://user-images.githubusercontent.com/94720207/208322704-398be835-e5a8-4030-9d95-06e4bbbbe6a9.png)

3. Al hacer click en "aceptar" quizás mande una serie de errores, posiblemente habrá que rieniciar GNS3 a mano, pero al final saldrá `Main Server`:

![image](https://user-images.githubusercontent.com/94720207/208322804-21fe029a-56b5-45f4-857b-d47ef78029cb.png)

- Al reiniciar GNS3:

![image](https://user-images.githubusercontent.com/94720207/208322837-43e48f87-2707-411f-beb5-c8a792b672c3.png)

## Importar el Laboratiorio al GNS3

1. Importar el File `*.gns3project` con `import portable project`

![image](https://user-images.githubusercontent.com/94720207/208314821-d99a7de2-1939-4cbe-a36d-52021623cac5.png)
![image](https://user-images.githubusercontent.com/94720207/208314905-46b4ee5d-38d9-4103-81aa-d439c99a6906.png)

-  En caso de marcar error de QEMU al faltar files, puede ser el Windows Server:

![image](https://user-images.githubusercontent.com/94720207/208319997-e093cdb6-7c31-4055-9f96-4bea6ea65eb4.png)

- Descarger Windows Server 2012 ver: `Win2k12_9600.16415.amd64fre.winblue_refresh.130928-2229_server_serverdatacentereval_en-us.vhd'`
    - https://www.microsoft.com/en-us/evalcenter/download-windows-server-2012-R2

- Poner en la carpeta de `\Laboratorio_Forti_Udemy02\LAB_Fz3r0_FG7\images\QEMU\`

![image](https://user-images.githubusercontent.com/94720207/208322461-f1f03284-e04b-4cea-81c7-94e18c331c55.png)

2. Así se debe ver el proceso de carga en las diferentes ventanas:

![image](https://user-images.githubusercontent.com/94720207/208323113-2b86218a-d4c5-4c5e-aaf9-917b108cd734.png)

- **OJO!!! La carga del proytecto es lenta, quizás tarde varios loops en `searching for server`, ser paciente...**

3. Al final después de varios ajustes de tamaños y pantalla a gusto de cada quien se verá el laboratiorio:

![image](https://user-images.githubusercontent.com/94720207/214655458-f1dcd401-be5c-4d93-9a42-aa6878e3c324.png)

## Tabla de Direccionamiento 

![image](https://user-images.githubusercontent.com/94720207/215289096-3c28e5e2-3d98-487e-bd49-954735e99938.png)

## Tomar Snapshot `Init`

- Ojo: De la misma manera tomar snapshots constants:

1. Manage Snapshot

![image](https://user-images.githubusercontent.com/94720207/208325124-75c9b3aa-b9b8-4452-b1fe-2863747b2a4e.png)

2. Create

![image](https://user-images.githubusercontent.com/94720207/208325171-d8945ae2-16a8-4c2e-b3ff-fbb88246c925.png)

3. Esperar a la creación del snapshot:

![image](https://user-images.githubusercontent.com/94720207/208325209-40b94240-33c6-4067-ab33-f2d21c10bc2a.png)

![image](https://user-images.githubusercontent.com/94720207/208325391-81d684ac-fa1d-4258-80ff-cc1fbabc48f2.png)


## Licencia Expirada de FortiGate

1. Hacer backup de configuración por CLI (Esto de hace por FTP)

    - Es mejor tener siempre un backup listo para cualquier situación...

````py
# Queda pendiente la config por FTP (clase 22)

````

2. Hacer un `factory reset` del FortiGate

    - Nota: Al utilizar el número `2` al final, se pierden todas las configs **EXCEPTO LAS CONFIGS DE RED**
    - Si no se utiliza el 2 las configuraciones serán totalmente nuevas y habrá que configurar de nuevo las IPs

````py
# Linea para hacer reset de fábrica sin perder config de red:

execute factoryreset2 


````









# FortiGate 7.0 - `Parte 2` - Iniciando por primera vez el FortiGate

## FortiGate Default Settings

| Default User | Default Password |
|--------------|------------------|
| `admin`      | _blank_          |

![image](https://user-images.githubusercontent.com/94720207/208325318-af19c877-77d1-4993-aa58-11e72c7a7d9e.png)

- Ojo: La IP fija default solo viene en equipos reales, en la VM viene por DHCP







## `Site A` - Initi y Configurar script en CLI para acceso Web

- Entrar y usar credenciales default `admin:admin`

- Reviso la IPv4 de la interface, ya que la usaré para entrar vía Web `HTTP`

````py
# Login inicial y cambio de password forzoso:

FortiGate-VM64-KVM login: admin
Password: 
You are forced to change your password. Please input a new password.
New Password: 
Confirm Password: 
Welcome!

# Intro de FortiGate:

WARNING: File System Check Recommended! An unsafe reboot may have caused an inconsistency in the disk drive.
It is strongly recommended that you check the file system consistency before proceeding.
Please run 'execute disk list' and then 'execute disk scan <ref#>'.
Note: The device will reboot and scan the disk during startup. This may take up to an hour.

# Comando "get" para obtener la IP de la interface, en este caso "192.168.14.130/24"

FortiGate-VM64-KVM # get system interface
== [ port1 ]
name: port1   mode: dhcp    ip: 192.168.14.130 255.255.255.0   status: up    netbios-forward: disable    type: physical   ring-rx: 0   ring-tx: 0   netflow-sampler: disable    sflow-sampler: disable    src-check: enable    explicit-web-proxy: disable    explicit-ftp-proxy: disable    proxy-captive-portal: disable    mtu-override: disable    wccp: disable    drop-overlapped-fragment: disable    drop-fragment: disable    
.
.
.

````

- En mi caso estos son los datos, es importante guardar la IP:

```
[ port1 ]

name: port1   
mode: dhcp    
ip:   192.168.14.130 / 255.255.255.0
```

### Editar Interface `Port 1` y entrar a la UI via web

- Habilito HTTP en el puerto 1:

```py
# entra a la config de la interface:
config system interface

# edita puerto 1
edit port1

# permitir acceso httP
append allowaccess http

# muestra las propiedades del puerto 1:
show

# guardar y salir del puerto 1:
end


```

- Entrar por web desde la PC Master Race que estemos usando (Fuera de VMs y GNS3, osea tu compu!!!): `192.168.14.133` 

![image](https://user-images.githubusercontent.com/94720207/213960854-0599b45b-1d0e-4f8b-98f1-2afdf4e96613.png)

- (Opcional) Hacer setup de Hostname y Dashboard, esto se puede hacer más adelante en cualquier momento... 

![image](https://user-images.githubusercontent.com/94720207/213960989-3eeefe8f-ecfb-4589-aa32-7a4ad4bbae19.png)
![image](https://user-images.githubusercontent.com/94720207/213961033-b7cae8ec-1cb8-4fb0-b5e5-918e69506125.png)

- Dashboard:

![image](https://user-images.githubusercontent.com/94720207/213961154-5bc3f4ff-cc47-450a-b432-aa76701ef10d.png)

- Esta listo el Forti-A, es hora de hacer lo mismo con el Forti-B




## `Site B` - Initi y Configurar script en CLI para acceso Web

- Entrar y usar credenciales default `admin:admin`

- Reviso la IPv4 de la interface, ya que la usaré para entrar vía Web `HTTP`

````py
# Login inicial y cambio de password forzoso:

FortiGate-VM64-KVM login: admin
Password: 
You are forced to change your password. Please input a new password.
New Password: 
Confirm Password: 
Welcome!

# Intro de FortiGate:

WARNING: File System Check Recommended! An unsafe reboot may have caused an inconsistency in the disk drive.
It is strongly recommended that you check the file system consistency before proceeding.
Please run 'execute disk list' and then 'execute disk scan <ref#>'.
Note: The device will reboot and scan the disk during startup. This may take up to an hour.

# Comando "get" para obtener la IP de la interface, en este caso "192.168.14.131/24"

FortiGate-VM64-KVM # get system interface
== [ port1 ]
name: port1   mode: dhcp    ip: 192.168.14.131 255.255.255.0   status: up    netbios-forward: disable    type: physical   ring-rx: 0   ring-tx: 0   netflow-sampler: disable    sflow-sampler: disable    src-check: enable    explicit-web-proxy: disable    explicit-ftp-proxy: disable    proxy-captive-portal: disable    mtu-override: disable    wccp: disable    drop-overlapped-fragment: disable    drop-fragment: disable    
````

- En mi caso estos son los datos, es importante guardar la IP:

```
[ port1 ]

name: port1   
mode: dhcp    
ip:   192.168.14.131 / 255.255.255.0
```

### Editar Interface `Port 1` y entrar a la UI via web

- Habilito HTTP en el puerto 1:

```py
# entra a la config de la interface:
config system interface

# edita puerto 1
edit port1

# permitir acceso httP
append allowaccess http

# muestra las propiedades del puerto 1:
show

# guardar y salir del puerto 1:
end


```

- Entrar por web desde la PC Master Race que estemos usando (Fuera de VMs y GNS3, osea tu compu!!!): `192.168.14.131` 

![image](https://user-images.githubusercontent.com/94720207/213961394-9f834754-b3f8-4c70-a455-2d66f4d320cb.png)

- Dashboard:

![image](https://user-images.githubusercontent.com/94720207/213961505-e8fc3cf2-2d3d-42cf-9ce3-d0737daff542.png)

- Quedaron ambos ForitGate listos para trabajar y con licencias activas!

## Configuraciones Finales de Laboratiorio

### Puerto 1 sin salida a Internet

- Ahora que están listos los 2 Forti solo debo asegurarme que no tengo salida a Internet desde los Forti (pero si desde el MikroTik)

1. Entro a cada uno de los forti: `192.168.14.130` & `192.168.14.131`

2. Entro a Network y soy doble click en el Puerto-1 (Management)

![image](https://user-images.githubusercontent.com/94720207/214100222-97ae463f-e80a-4dff-98e3-71bb22b2281b.png)

3. Apagar las siguientes opciones:

![image](https://user-images.githubusercontent.com/94720207/214100700-190ad7d8-329b-4ad7-b2f0-ea78b3715999.png)

4. Doy click en "OK" y hago lo mismo en el otro FortiGate. 

- Es importante que ningun Port-1 tenga salida a la WAN (Internet) ya que solo los estoy usando con fines de administración en este laboratorio, es por ello que se apagaron los dateway y DNS en ambas interfaces. 

## Theme, Time, Intro & Gimicks 

- Cambiar la zona horaria por la actual:

![image](https://user-images.githubusercontent.com/94720207/214102836-96b24e2b-b0dd-44ce-b7f9-5e2b047ca5ef.png)

- Iddle time out

![image](https://user-images.githubusercontent.com/94720207/214103618-847dc485-a3dc-4dbf-a948-6c444310e6bd.png)

- Theme

![image](https://user-images.githubusercontent.com/94720207/214103772-e4217121-cf6a-4376-8a56-b3c33b6243fa.png)

- Auto File System Check

![image](https://user-images.githubusercontent.com/94720207/214104570-3ea0d98c-df57-4c61-8d22-46d85e4d85d7.png)

- Intro Message

## Manera Correcta de Apagar Fortigate

- En caso de apagar el FortiGate con el botón "stop" de GNS, o apagarlo del botón o cable un FortiGate real podría dañar el sistema.

- Es por eso que se debe apagar de la siguiente manera antes de quitar electricidad o cerrar máquina virtual:

#### UI

![image](https://user-images.githubusercontent.com/94720207/214105158-8b8574fc-9cdf-4afa-aa34-16068b46956b.png)

#### CLI

````py
execute shutdown
````

## Dashboard y Widgets en FortiGate

- Hay recursos muy buenos donde ver como recorrer y crear Widgets para el Dashboard, incluyendo otros socumentos en mi Github, pero recomiendo los siguientes:

    - https://docs.fortinet.com/document/fortigate/6.2.0/cookbook/433781/fortiview-dashboards-and-widgets

## Revisar Información de FortiGate (Status)

````py
# Obtener información de FortiGate

get system status
````

````py
FortiGate-Fz3r0-Site-A # get system status
Version: FortiGate-VM64-KVM v7.0.3,build0237,211207 (GA)
Virus-DB: 1.00000(2018-04-09 18:07)
Extended DB: 1.00000(2018-04-09 18:07)
Extreme DB: 1.00000(2018-04-09 18:07)
AV AI/ML Model: 0.00000(2001-01-01 00:00)
IPS-DB: 6.00741(2015-12-01 02:30)
IPS-ETDB: 6.00741(2015-12-01 02:30)
APP-DB: 6.00741(2015-12-01 02:30)
INDUSTRIAL-DB: 6.00741(2015-12-01 02:30)
IPS Malicious URL Database: 1.00001(2015-01-01 01:01)
Serial-Number: FGVMEVVCMS77GA33
License Status: Valid
Evaluation License Expires: Mon Feb  6 22:15:51 2023
VM Resources: 1 CPU/1 allowed, 2007 MB RAM/2048 MB allowed
Log hard disk: Available
Hostname: FortiGate-Fz3r0-Site-A
Operation Mode: NAT
Current virtual domain: root
Max number of virtual domains: 1
Virtual domains status: 1 in NAT mode, 0 in TP mode
Virtual domain configuration: disable
FIPS-CC mode: disable
Current HA mode: standalone
Branch point: 0237
Release Version Information: GA
FortiOS x86-64: Yes
System time: Mon Jan 23 14:05:31 2023
Last reboot reason: power cycle

FortiGate-Fz3r0-Site-A #
````

## Bonus: Configuración del padrino Fz3r0

- Un script personal para init de FortiGate con algunas configuraciones adicionales que utilizo para iniciar es el siguiente (En este caso utilizando una IP estática)

````py
config system interface
edit port1
set description "WAN1-TELMEX-LEFT-ISP"
set alias "WAN1-TELMEX"
set mode static
set ip 192.168.30.100 255.255.255.0
select allowaccess ping https ssh http
set lldp-reception enable
end

config system global
set hostname "Fz3r0_FortiGate1_MASTER"
set alias "Fz3r0_FortiGate1_MASTER_alias"
set gui-theme onyx
set pre-login-banner enable
set post-login-banner enable
set admintimeout 60
set timezone 04  
end

config system admin
edit "Fz3r0"
set accprofile "super_admin"
set comments "Fz3r0:Fz3r0.12345"
set vdom "root"
config gui-dashboard
end
end



````



## Configuraciones Adicionales de MikroTik Routerboard (WANs)

- Entrar al Mikro con la siguientes credenciales

|         User |         Password |
|--------------|------------------|
| `admin`      | `Fortinet1!`     |

### Verificar Interfaces / IPv4

````sh
/ip address print
````
````java                             
[admin@INTERNET] > /ip address print
Flags: X - disabled, I - invalid, D - dynamic 
 #   ADDRESS            NETWORK         INTERFACE                              
 0   200.212.31.2/30    200.212.31.0    ether2                                 
 1   180.45.22.2/30     180.45.22.0     ether3                                 
 2   60.89.123.2/30     60.89.123.0     ether4                                 
 3   45.32.12.2/30      45.32.12.0      ether5                                 
 4 D 192.168.30.130/24  192.168.30.0    ether1    <<<--- DHCP desde mi Internet en ETH1 (port0 para GNS3)
````

### Verificar salida a Internet & ping

````py
# Ping a una IP (Google DNS)

ping 1.1.1.1
````
````py
# Ping a una URL (resuelta por DNS)

ping google.com
````
````py
[admin@INTERNET] > ping 1.1.1.1
  SEQ HOST                                     SIZE TTL TIME  STATUS           
    0 1.1.1.1                                    56 128 45ms 
    1 1.1.1.1                                    56 128 40ms 
    2 1.1.1.1                                    56 128 43ms 
    3 1.1.1.1                                    56 128 42ms 
    sent=4 received=4 packet-loss=0% min-rtt=40ms avg-rtt=42ms max-rtt=45ms 
    
[admin@INTERNET] > ping google.com
  SEQ HOST                                     SIZE TTL TIME  STATUS           
    0 108.177.11.138                             56 128 68ms 
    1 108.177.11.138                             56 128 61ms 
    2 108.177.11.138                             56 128 68ms 
    3 108.177.11.138                             56 128 62ms 
    sent=4 received=4 packet-loss=0% min-rtt=61ms avg-rtt=64ms max-rtt=68ms     
````

### Cambiar IP a interfaces (DHCP/Estática)

- Es importgante cambiar las `x.x.x.x` por la IP fija que queremos.

- El gateway se debe usar el real del router del laboratiorio, ej. `192.168.1.254` "Telmex"

````py
#Desactivar el cliente DHCP
/ip dhcp-client remove numbers=0

#Colocar una ip de nuestra red que no este en uso
#Reemplazar x.x.x.x por la ip
/ip address add address=x.x.x.x/24 interface=ether1

#Crear la default route utilizando nuestro GATEWAY
#Reemplazar x.x.x.x por la ip
/ip route add dst-address=0.0.0.0/0 gateway=x.x.x.x

#Establecer un servidor DNS
/ip dns set servers=8.8.8.8
````





# FortiGate 7.0 - `Parte 3` - Configuraciones de Interfaces

## Configurar IP estática en `Management`

- Para este Lab utilizaré las mismas que ya me había asignado el DHCP `192.168.14.130` & `192.168.14.131`. 

1. `Network > Interfaces > Port 1`

#### UI

![image](https://user-images.githubusercontent.com/94720207/214125424-6428af81-4652-494f-8679-457167dfa67a.png)

#### CLI

````py
# Configurar un puerto con IP estática

config system interface
edit port1
set description "Port1-MGMT"
set alias "Port1-MGMT"
set mode static
set ip 192.168.14.130 255.255.255.0
select allowaccess ping https ssh http
set lldp-reception enable
end
````

## Configurar IP dinámica (DHCP) en `Management`

1. Es simplemente seleccionar DHCP en modo UI al revés de la opción de estática.

#### CLI

````py
# Configurar un puerto con IP por DHCP

config system interface
edit port1
set description "Port1-MGMT"
set alias "Port1-MGMT"
set mode dhcp
select allowaccess ping https ssh http
set lldp-reception enable
end
````

## Configurar Interfaces `WAN`

- Configuraré ambas salidas a las WANs en ambos Fortigate. 
- Cada uno de los FortiGate tiene 2 WANs diferentes (salidas a Internet)

    - FortiGate `Site-A`:
        - Port 2 = `WAN_1` = Network ID `200.212.31.0/30` = FG_A IP PT_2: `200.212.31.1/30` = GW(WAN_1) = `200.212.31.2/30`
        - Port 3 = `WAN_2` = Network ID `180.45.22.0/30` = FG_A IP PT_3: `180.45.22.1/30` = GW(WAN_2) = `180.45.22.2/30` 

    - FortiGate `Site-B`:
        - Port 2 = `WAN_3` = Network ID `45.32.12.0/30` = FG_B IP PT_2: `45.32.12.1/30` = GW(WAN_3) = `45.32.12.2/30` 
        - Port 3 = `WAN_4` = Network ID `60.89.123.0/30` = FG_B IP PT_2: `60.89.123.1/30` = GW(WAN_4) = `60.89.123.2/30` 

### Interfaces MikroTik

[admin@INTERNET] > /ip address print
Flags: X - disabled, I - invalid, D - dynamic 
 #   ADDRESS            NETWORK         INTERFACE                              
 0   200.212.31.2/30    200.212.31.0    ether2 (1)    --->>>  Port 2 SiteA  (WAN_1)                            
 1   180.45.22.2/30     180.45.22.0     ether3 (2)    --->>>  Port 3 SiteA  (WAN_2)                            
 2   60.89.123.2/30     60.89.123.0     ether4 (3)    --->>>  Port 2 SiteB  (WAN_3)                              
 3   45.32.12.2/30      45.32.12.0      ether5 (4)    --->>>  Port 3 SiteB  (WAN_4)                                 
 4 D 192.168.30.130/24  192.168.30.0    ether1 (0)    --->>>  WAN Internet real




![image](https://user-images.githubusercontent.com/94720207/214131591-d51e99f2-7ae0-4456-8363-66801682e035.png)

- Nota: Pondré como acceso habilitado solo ping para hacer pruebas, pero la buena práctica sería deshabilitar accesos en ese borde.

---

#### UI

![image](https://user-images.githubusercontent.com/94720207/214133640-742d85f4-0c54-4484-9c7e-3d5c62e66756.png)

#### CLI

````py
# Configurar puertos WAN con IP estática FortiGate

config system interface
edit port2
set description "WAN_1"
set alias "WAN_1"
set mode static
set ip 200.212.31.1/30
set role wan
select allowaccess ping
end


````

---

_Repetir lo mismo con cada una de las interfaces utilizando la IP correspondiente a cada WAN (En este caso utilizando `xx.xx.xx.1`)_

### Resultado

- Al finalizar se verán las `interfaces WAN` con su IP asignada (repetir lo mismo en ambos FortiGate):

![image](https://user-images.githubusercontent.com/94720207/214134366-11bbae3d-f677-4fc4-acad-0e7b80d854d0.png)

- En este momento se puede hacer ping hacia los GateWay (MikroTik WAN), pero no a Internet (ya que falta default route)

````py
FortiGate-Fz3r0-Site-A # exec ping 200.212.31.2
PING 200.212.31.2 (200.212.31.2): 56 data bytes
64 bytes from 200.212.31.2: icmp_seq=0 ttl=64 time=1.9 ms
64 bytes from 200.212.31.2: icmp_seq=1 ttl=64 time=3.2 ms
64 bytes from 200.212.31.2: icmp_seq=2 ttl=64 time=0.4 ms
64 bytes from 200.212.31.2: icmp_seq=3 ttl=64 time=0.5 ms
64 bytes from 200.212.31.2: icmp_seq=4 ttl=64 time=0.7 ms

--- 200.212.31.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 0.4/1.3/3.2 ms

FortiGate-Fz3r0-Site-A # 
````

## Configurando `Default Route` / `Static Route`

- Para poder tener salida a Internet todos los Routers necesitan una Default Route.

- Utilizar como `Gateway` la IP que corresponde a la interface de cada WAN, ese es mi Gateway de cada salida (Como en el mundo real...)

    - GW(WAN_1) = `200.212.31.2`
    - GW(WAN_2) = `180.45.22.2` 
    - GW(WAN_3) = `45.32.12.2` 
    - GW(WAN_4) = `60.89.123.2` 

- Nota: Solo es necesario agregar el Gateway y solo acompletará lo demás, el destination será `0.0.0.0/0.0.0.0`

---

#### UI

![image](https://user-images.githubusercontent.com/94720207/214137157-97bedc2f-daa5-4f87-96d9-292c609f2d44.png)

- En caso que a la WAN 2 le ponga una `administrative distance` mas alta, entonces será utilizado como backup, dando preferencia a distancia `10` (default)

![image](https://user-images.githubusercontent.com/94720207/214137722-9f45cb1f-7bce-433c-aefd-96b48b709d5f.png)

#### CLI

````py
# Default Route (Para acceso a Internet)

config router static
edit 1
set gateway 45.32.12.2
set device port2 

# Con "next" puedo brincar a la siguiente configuración sin dar "end" y "config" 2 veces
next

edit 2
set gateway 60.89.123.2
set device port3
set distance 15 
end
````

---

- Al final se verá algo así:

![image](https://user-images.githubusercontent.com/94720207/214137945-187e94be-ccdb-433f-96a6-6ea1696e9897.png)

- Ya puedo hacer ping a Internet:

````py
FortiGate-Fz3r0-Site-A # execute ping 1.1.1.1
PING 1.1.1.1 (1.1.1.1): 56 data bytes
64 bytes from 1.1.1.1: icmp_seq=0 ttl=127 time=41.2 ms
64 bytes from 1.1.1.1: icmp_seq=1 ttl=127 time=54.9 ms
64 bytes from 1.1.1.1: icmp_seq=2 ttl=127 time=45.4 ms
64 bytes from 1.1.1.1: icmp_seq=3 ttl=127 time=46.1 ms
64 bytes from 1.1.1.1: icmp_seq=4 ttl=127 time=39.5 ms

--- 1.1.1.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 39.5/45.4/54.9 ms

FortiGate-Fz3r0-Site-A # execute ping google.com
PING google.com (173.194.213.102): 56 data bytes
64 bytes from 173.194.213.102: icmp_seq=0 ttl=127 time=63.4 ms
64 bytes from 173.194.213.102: icmp_seq=1 ttl=127 time=62.8 ms
64 bytes from 173.194.213.102: icmp_seq=2 ttl=127 time=69.9 ms
64 bytes from 173.194.213.102: icmp_seq=3 ttl=127 time=68.5 ms
64 bytes from 173.194.213.102: icmp_seq=4 ttl=127 time=78.8 ms

--- google.com ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 62.8/68.6/78.8 ms

FortiGate-Fz3r0-Site-A # 
````

## Configurar Interfaces `LAN`

- Las IPs que utilizaré en las interfaces de los FortiGate hacia las LAN son:

    - FortiGate `Site A` = `10.0.1.254/24`
    - FortiGate `Site B` = `10.0.2.254/24`

---

#### UI

![image](https://user-images.githubusercontent.com/94720207/214147563-e116eb14-82fc-4baa-a961-809b9d6351db.png)

#### CLI

````py
# Configuración Port4 = LAN_Windows_P

config system interface
edit port4
set description "LAN_Windows_PC"
set alias "LAN_Windows_PC"
set mode static
set ip 10.0.2.254/24
set role lan
select allowaccess ping
end



````

---

### Resultado:

- Así se verían las 4 interfaces ya configuradas, lo mismo se debe hacer en ambos FortiGate

![image](https://user-images.githubusercontent.com/94720207/214147856-1eda46a8-efdf-4022-968c-cdc55573a140.png)

## Configuración de Interfaces del Padrino Fz3r0

- En este Script configuro todas las interfaces del `Site-B`, con solo modificar las IPs funcionaría también para el `Site-A` el cual se mostró como configurar por UI.

- **Ojo que en GNS3 venbían movidas unas WANs, no eran por orden asíq ue tuve que identificar interface por interface para que funcionara correctamente:**

![image](https://user-images.githubusercontent.com/94720207/214164085-4259556a-1d73-472a-99dc-7f91d355f717.png)

````py
#
#    CONFIGURACIÓN DE INTERFACES FORTIGATE_SITE_B  
#

# Configuración Port1 = Management_MGMT

config system interface
edit port1
set description "Management-MGMT"
set alias "Management-MGMT"
set mode static
set ip 192.168.14.131/24
set role lan
select allowaccess ping ssh http https
set lldp-reception enable
end

# Configuración Port2 = WAN_4

config system interface
edit port2
set description "WAN_4"
set alias "WAN_4"
set mode static
set ip 60.89.123.1/30
set role wan
select allowaccess ping
end

# Configuración Port3 = WAN_3

config system interface
edit port3
set description "WAN_3"
set alias "WAN_3"
set mode static
set ip 45.32.12.1/30
set role wan
select allowaccess ping
end

# Configuración Port4 = LAN_Windows_P

config system interface
edit port4
set description "LAN_Windows_PC"
set alias "LAN_Windows_PC"
set mode static
set ip 10.0.2.254/24
set role lan
select allowaccess ping
end

# Default Route (Para acceso a Internet)

config router static
edit 1
set gateway 60.89.123.2
set device port2 

# Con "next" puedo brincar a la siguiente configuración sin dar "end" y "config" 2 veces
next

edit 2
set gateway 45.32.12.2
set device port3
set distance 15 
end




````

## Comprobaciones de Configuraciones iniciales

- Se debe poder hacer ping a todos los Gateways WAN (MikroTik) de los 4 puertos y 4 WANs de los 2 FortiGate

````py
FortiGate-Fz3r0-Site-B # execute ping 60.89.123.2
PING 60.89.123.2 (60.89.123.2): 56 data bytes
64 bytes from 60.89.123.2: icmp_seq=0 ttl=64 time=1.2 ms
64 bytes from 60.89.123.2: icmp_seq=1 ttl=64 time=0.5 ms
64 bytes from 60.89.123.2: icmp_seq=2 ttl=64 time=0.4 ms
64 bytes from 60.89.123.2: icmp_seq=3 ttl=64 time=0.4 ms
64 bytes from 60.89.123.2: icmp_seq=4 ttl=64 time=0.4 ms

--- 60.89.123.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 0.4/0.5/1.2 ms

FortiGate-Fz3r0-Site-B # execute ping 45.32.12.2
PING 45.32.12.2 (45.32.12.2): 56 data bytes
64 bytes from 45.32.12.2: icmp_seq=0 ttl=64 time=2.6 ms
64 bytes from 45.32.12.2: icmp_seq=1 ttl=64 time=0.8 ms
64 bytes from 45.32.12.2: icmp_seq=2 ttl=64 time=0.6 ms
64 bytes from 45.32.12.2: icmp_seq=3 ttl=64 time=0.5 ms
64 bytes from 45.32.12.2: icmp_seq=4 ttl=64 time=0.4 ms

--- 45.32.12.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 0.4/0.9/2.6 ms

FortiGate-Fz3r0-Site-B #
````

- Ahora ambos FortiGate deben hacer ping hacia Internet `1.1.1.1` o `google.com`

````py
FortiGate-Fz3r0-Site-A # execute ping 1.1.1.1
PING 1.1.1.1 (1.1.1.1): 56 data bytes
64 bytes from 1.1.1.1: icmp_seq=0 ttl=127 time=43.1 ms
64 bytes from 1.1.1.1: icmp_seq=1 ttl=127 time=43.3 ms
64 bytes from 1.1.1.1: icmp_seq=2 ttl=127 time=41.1 ms
^C
--- 1.1.1.1 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 41.1/42.5/43.3 ms

FortiGate-Fz3r0-Site-A # ping google.com
Unknown action 0

FortiGate-Fz3r0-Site-A # execute ping google.com
PING google.com (142.251.132.14): 56 data bytes
64 bytes from 142.251.132.14: icmp_seq=0 ttl=127 time=165.1 ms
64 bytes from 142.251.132.14: icmp_seq=1 ttl=127 time=166.2 ms
64 bytes from 142.251.132.14: icmp_seq=2 ttl=127 time=163.8 ms
64 bytes from 142.251.132.14: icmp_seq=3 ttl=127 time=166.0 ms
64 bytes from 142.251.132.14: icmp_seq=4 ttl=127 time=183.2 ms

--- google.com ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 163.8/168.8/183.2 ms
````

- Desde las estaciones de trabajo en la LAN pueden hacer ping hacia sus Gateways, pero aún no pueden salir a Internet (aún no se crean políticas)

![image](https://user-images.githubusercontent.com/94720207/214166188-64ed4dac-d7ef-49f4-a76a-fc56127c7e77.png)



# FortiGate 7.0 - `Parte 4` - Backup, Restore, Revisions & Scripts

## Backups & Restore

#### UI

- Para guardar un backup:

![image](https://user-images.githubusercontent.com/94720207/214167948-484b4266-52b9-4bcd-b262-7d55891ea4c6.png)
![image](https://user-images.githubusercontent.com/94720207/214168471-fa79a024-0187-4a4a-890e-d6c97d2a2266.png)

- Para cargar un backup:

![image](https://user-images.githubusercontent.com/94720207/214170925-cd79a535-5e94-4b0c-a0ba-b66cee6cebec.png)
![image](https://user-images.githubusercontent.com/94720207/214171227-e5555e0a-d67c-4fec-b748-fe5058f3445d.png)

- Los backups se guardan en texto plano y son muy útiles no solo para tener el respaldo, sino para cambios de configuración via CLI

![image](https://user-images.githubusercontent.com/94720207/214171411-86b65e08-2737-4bd4-934c-9565dca5ad55.png)

#### CLI

- Para guardar y cargar backups por CLI se necesita un servidor FTP dando servicio. 

- En este laboratorio el MikroTik también puede servir como `FTP server` y las credenciales para acceder via FTP son:

|         User |         Password |
|--------------|------------------|
| `ftp`        | `ftp`            |

- La IP del servidor puede ser cualquiera de las interfaces de la WAN, ya que cualquiera de ellas en realidad es el MikroTik haciendo el "truco" de las WANs. Además, debido a esto al alcanzar cualquier Gateway podré alcanzal cualquiera de los otros 3. 

- Hacer Backup:

````py
# Existen varias opciones de hacer un backup pero en este lab usaré FTP

execute backup config ftp FortiGate-Fz3r0-Site-B_backup.conf 180.45.22.2 ftp ftp
````
````py
# Ejemplo:

FortiGate-Fz3r0-Site-B # execute backup config ftp FortiGate-Fz3r0-Site-B_backup.conf 180.45.22.2 ftp ftp
Please wait...

Connect to ftp server 180.45.22.2 ...
Send config file to ftp server OK.

FortiGate-Fz3r0-Site-B #
````

- Restaurar Backup:

````py
# El restore es exactamente la misma linea que el backup pero con "resotre"

execute restore config ftp FortiGate-Fz3r0-Site-B_backup.conf 180.45.22.2 ftp ftp
````
````py
FortiGate-Fz3r0-Site-B # execute restore config ftp FortiGate-Fz3r0-Site-B_backup.conf 180.45.22.2 ftp ftp
This operation will overwrite the current setting and could possibly reboot the system!
Do you want to continue? (y/n)y

Please wait...

Connect to ftp server 180.45.22.2 ...
Get config file from ftp server OK.
File check OK.

FortiGate-Fz3r0-Site-B # 
````

## Revisions

- Las revisiones son para mantener backups localmente en el FortiGate de manera que si quiero regresar a alguna otra revisión lo pueda hacer fácilmente o hacer comparaciones de historial de cambios. 

![image](https://user-images.githubusercontent.com/94720207/214173853-3464728f-61fc-41cc-8121-352f046baeb3.png)

- Para revisarlas o hacer revisiones se puede utilizar la lista que se creó:

![image](https://user-images.githubusercontent.com/94720207/214174058-af9ffaee-0fbf-48dd-aeaa-7644f2a8171f.png)






# FortiGate 7.0 - `Parte 5` - Gestionando `Users/ Admins` 

## Admin por Default `super-user` & `prof-user`

- Este es el admin que trae el FortiGate por defecto:

![image](https://user-images.githubusercontent.com/94720207/214720303-61f135c3-ecb3-470d-a51f-2bb0317a7cf0.png)

- Así mismo, hay perfiles de administrador que dan características a los usarios admin (`super_admin` no es modificable)

- Por default, `prof_admin` tiene el mismo perfil que `super_admin`, pero "profesional/prof" si se puede modificar:

![image](https://user-images.githubusercontent.com/94720207/214720568-bf8ddf81-f793-41c9-8c3a-8122c44d1105.png)

- Nota: Las opciones que dicen `custom` tiene opciones más granulares que las básicas. 

## `Crear User` y asignarle un `perfil de admin`

- Para crear un usuario se realiza el siguiente proceso:

#### UI

1. Solo seguir los sencillos pasos para crear usuario en la pestaña `Administrators`:

![image](https://user-images.githubusercontent.com/94720207/214721277-a1b1b8a2-4102-4b54-94c7-e2eb12f89e9a.png)

2. Llenar la plantilla: 

![image](https://user-images.githubusercontent.com/94720207/214721809-1a341d62-f400-423c-a2fc-b60ead27a093.png)

3. Ya se mostrará el user local:

![image](https://user-images.githubusercontent.com/94720207/214721948-55735cf8-8d55-4bf3-8feb-0eb8cbe587b5.png)

- Nota: Una vez creado el usuario ya se puede entrar a editar el CLI

#### CLI

- Nota: El password encriptado es opcional, se puede dejar vacío y lo pedirá la primera vez de login.

````py
# Configurar admin con perfil super-admin

config system admin
edit "Fz3r0"
set accprofile "super_admin"
set comments "User:Password = Fz3r0:Fz3r0.12345"
set password ENC SH2eHdobloLvG+a4A65k+jfWXUlH/dmOiQzPZ368GVpMjFmlXGZsNPWNK2eYQo=
set vdom "root"
config gui-dashboard
end



````

## Bonus!!! Fz3r0 Admin

````py

# * Configurar Administrator Profile
#
#   - Este perfil es exactamente el mismo que un super-admin (todo read-write)
#   - Adicionalmente tiene el timeout session infinito (últimas 2 lineas)

config system accprofile
edit "Fz3r0 - Lord Of Darkness  💀"
set comments "Fz3r0 Hyper-Admin Profile [same as super-admin... but...  with more darkness! pew pew🎃]"
set secfabgrp read-write
set ftviewgrp read-write
set authgrp read-write
set sysgrp read-write
set netgrp read-write
set loggrp read-write
set fwgrp read-write
set vpngrp read-write
set utmgrp read-write
set wanoptgrp read-write
set wifi read-write
set admintimeout-override enable
set admintimeout 0
end

# * Creando super-admin [hyper-admin ;)]
#
#   - Este Admin tiene todos los privilegios
#   - Fz3r0:Fz3r0.12345

config system admin
edit "Fz3r0"
set accprofile "Fz3r0 - Lord Of Darkness  💀"
set comments "[hyper-admin @ Lord Of Darkness] I\'m Fz3r0 and the Sun no longer rises..."
set vdom "root"
set password Fz3r0.12345
end

# * Creando prof-admin [sub administrador]
#
#   - Este Admin tiene menos privilegios (no System & VPN)
#   - Simon_Belmont:4luc4rd_0
#   - Adicionalmente tiene el timeout session de 5 minutos

config system accprofile
edit "prof_admin"
set comments "No tiene permisos de: System, VPN"
set secfabgrp read-write
set ftviewgrp read-write
set authgrp read-write
set netgrp read-write
set loggrp read-write
set fwgrp read-write
set utmgrp read-write
set wanoptgrp read-write
set wifi read-write
set admintimeout-override enable
set admintimeout 5
end



````






# FortiGate 7.0 - `Parte 6` - Policy: `Acceso a Internet`

- La primer policy normalmente configurada es dar `acceso a Internet` a la(s) `LAN`.
- Hasta el momento la Lan puede hacer ping al Gateway (FortiGate) pero no a Internet. 

![image](https://user-images.githubusercontent.com/94720207/214759761-f1fe9632-021b-448d-a7a1-175480e4338c.png)

- Esto es porque para eso se necesita una política, como para la mayoría de escenarios y situaciones!

    - HINT: Todo lo que es creado en la lista de **`Policy & Objects`** es tarde o temprano utilizado en una `Firewall Policy`, es decir, la creación de un `objeto` no tiene sentido si no pasa después por una `policy`:

![image](https://user-images.githubusercontent.com/94720207/214760603-e6db454d-16f2-4fa3-af74-700e84baea08.png)

- Esta regla implicita lo que dice es: 

    - `De cualquier origen` > `A cualquier destino` > `En cualquier momento` > `Cualquier servicio` > `se deniega`
    
- A partir de esta regla se construye, todas las `políticas de aceptación` deben ir ARRIBA ya que es

    - HINT: Todas las políticas de cran con una `interfaz de origen` y una `interfaz de destino`.

## Creando la Policy: `Acceso a Internet`

- Seguir los siguientes pasos:

##### UI

1. `Firewayy Policy` > `Create`:

![image](https://user-images.githubusercontent.com/94720207/214761612-d4e572dd-1d05-430a-912e-296bf4cd34c2.png)

2. Llenar el formulario

![image](https://user-images.githubusercontent.com/94720207/214919459-1dfa0783-3b14-4984-b5a1-c0a4868dfdd9.png)

3. Se puede poner un comentario y revisar que la política esté activada

![image](https://user-images.githubusercontent.com/94720207/214919602-c902def6-0091-4810-a1d5-c45f44130854.png)

- Ahora se puede verificar la política creada por vista `pair view` o `by sequence` (lo normal es en pares):

![image](https://user-images.githubusercontent.com/94720207/214920158-c2ab7b80-bfbf-4cb9-8ed0-4a97b4053cbe.png)

![image](https://user-images.githubusercontent.com/94720207/214920229-9c4969b4-a7f3-4262-9493-e97ffe1d47bf.png)

- Ya se puede hacer ping a Internet: 

![image](https://user-images.githubusercontent.com/94720207/214920842-e680c1c2-382b-496b-8c8b-36477aec0f8f.png)

- Hacer lo mismo con `Site-B` y probar conectividad:

![image](https://user-images.githubusercontent.com/94720207/214921646-27657660-d8ce-40b3-8c85-fa25d8b9741e.png)

#### CLI

````py
# Configuración de politica a salida a Internet 

# Desde la LAN (Port-4) ---> Hacia la WAN (Port-2)

config firewall policy
edit 1
set name "Internet_(In_Out)"
set uuid 93fd3ae0-9da8-51ed-d7cf-35c962844689
set srcintf "port4"
set dstintf "port2"
set action accept
set srcaddr "all"
set dstaddr "all"
set schedule "always"
set service "ALL"
set nat enable
set comments "Politica de Input y Output de Internet"
````

## Politica de Internet by Fz3r0

````py
# Configuración de politica a salida a Internet 

# Desde la LAN (Port-4) ---> Hacia la WAN (Port-2)

config firewall policy
edit 1
set name "Internet_(In_Out)"
set uuid 93fd3ae0-9da8-51ed-d7cf-35c962844689
set srcintf "port4"
set dstintf "port2"
set action accept
set srcaddr "all"
set dstaddr "all"
set schedule "always"
set service "ALL"
set nat enable
set comments "Politica de Input y Output de Internet"
````






# FortiGate 7.0 - `Parte 7` - Objects: `Address`, `Schedule` & `Service`

## Crear object: `Addresses`

- En `Addresses` ya existen objectos creados por defecto:

![image](https://user-images.githubusercontent.com/94720207/214923623-4c8104ff-20d0-45da-a995-1dd1296c39ea.png)

- `IP Ranges Subnet` - Se puede asignar un rango de direcciones IPs o una IP en particular (OJO! **Una IP sola siempre debe terminar en `/32`**)
- `FQDN` - Todos los Nombre de dominio completamente calificados.
- `Address` - Son grupos que se componen de otros `objetos`
- Todos los tipos de la lista: 

![image](https://user-images.githubusercontent.com/94720207/214948879-237372fe-88f5-4063-b83f-c5855fc0e968.png)

#### UI

1. `Addresses` > `Create new`

![image](https://user-images.githubusercontent.com/94720207/214961347-88edb97d-e22c-4234-a42b-7b71f3099bf5.png)


2. Llenar formulario:

![image](https://user-images.githubusercontent.com/94720207/214961618-281dac6c-9c88-4411-b54d-dad9b96cdb89.png)

3. `Usar objeto`

- El objeto ya está creado en Addresses, pero aún no se ha utilizado: 

![image](https://user-images.githubusercontent.com/94720207/214949559-cb69f691-3a42-4e0a-9c5b-9d95de3b6610.png)

- Rfcordar, para que un `objeto` sea funcional hay que activarlo en la `policy`
- `Direwall Policy` > `Internet_(In_Out)` (Es la política de Internet que hice, ahora en lugar de seleccionar `all` lo puedo cambiar por mi `objeto`)

![image](https://user-images.githubusercontent.com/94720207/214961779-de8ea8cf-cb99-4ae2-ace0-99fc109716d4.png)


- Ahora se verá el par con la política nueva: 

![image](https://user-images.githubusercontent.com/94720207/214961839-cc619cbc-e953-4360-a924-4b1397c95bb6.png)

- Ahora solo el `Windows Server / Active Directory` tiene acceso a Internet, si yo le cambio la IP a esa máquina o intento con otra PC, no tendría salida a Internet: 

![image](https://user-images.githubusercontent.com/94720207/214959723-b144feda-e2a1-46f1-a108-5f95673c413c.png)

![image](https://user-images.githubusercontent.com/94720207/214962278-b41b062b-0cef-4e80-a719-a636f8a1cb4a.png)

#### CLI


## Crear object: `Services`

- Para ser más específicos que por ejemplo los objetos `Addresses`, se pueden crear objetos de servicios, por ejemplo, para dejar al host navegar, pero solo usando `HTTP` _(o cualquier protocolo)_
- NOTA: En el caso de `HTTP` o protocolos conocidos, ya existe incluso el objeto creado para cada uno:

![image](https://user-images.githubusercontent.com/94720207/214974070-5e006572-b162-4ad2-9376-c78f72897fa9.png)

#### UI

- Para crear el objeto de `Services` solo es necesario:

1. `Services` > `Create New` > (seleccionar)

![image](https://user-images.githubusercontent.com/94720207/214974271-06d9e19f-cd9c-4325-958c-191154d9c952.png)

2. Ajustar el objeto a las necesidades del servicio a filtrar (Por ahora no haré ningún servicio en este lab, utilizaré los protocolos conocidos ya creados)

![image](https://user-images.githubusercontent.com/94720207/214974519-947d7f65-e258-4ecc-9dc2-a071ab69da63.png)

3. De la misma manera que cualquier objeto... Ahora se debe asignar a la política, en este caso en la sección de `service`:

![image](https://user-images.githubusercontent.com/94720207/214974762-c9e04f77-ff92-4ae6-8814-4a2b82b1b115.png)

- Agregaré `HTTP`, `HTTPS` y `DNS` (Así resolverá una página de Internet, pero no hará ping ICMP)

![image](https://user-images.githubusercontent.com/94720207/214975470-fe802136-6a9c-49ff-88fa-0cd88cf44af9.png)

![image](https://user-images.githubusercontent.com/94720207/214975604-68107c9f-a718-4d32-8e3a-e10f1d4effd7.png)

- Ahora que está listo el `objeto de servicio` asignado a la `política`, se puede ver como tengo acceso a Internet via web (`HTTP, HTTPS & DNS`), pero no puedo hacer ping (`ICMP`). 
- Incluso, se puede notar como al hacer ping a `google.com` se resuleve la dirección, pero no hace ping. 

![image](https://user-images.githubusercontent.com/94720207/215242829-5c2b8c52-7020-46a2-8f2f-1f17dbeb007a.png)

- NOTA: También en el ícono de LAN de Windows marca `Conectividad Limitada`

![image](https://user-images.githubusercontent.com/94720207/215242852-12ebc862-9737-4003-ab54-78d541036676.png)
![image](https://user-images.githubusercontent.com/94720207/215242870-71645386-c4d6-450d-9027-608c8fbc07a8.png)

- Si por ejemplo tratop de navegar o utilizar una webapp que use más protocolos además de HTTP, HTTPS o DNS (como speedtest.org) la página no sería 100% funcional. 
- Usando el ejemplo de `speedtest.org` se puede ver como no puede hacer nunca la descarga para iniciar el test, pero si carga la página, en cambio si regreso el `objeto de services` a `all` podré uevamente hacer un speedtest:

![image](https://user-images.githubusercontent.com/94720207/215273262-7e1de36e-cd02-4e69-88c0-fff5f381e041.png)
![image](https://user-images.githubusercontent.com/94720207/215272964-c0d18506-4fbc-4b32-bbc2-e65d668db4a3.png)


#### CLI


## Crear object: `Schedules`

- En este apartado por default no vienen muchas opciones, lo normal es configurar un nuevo horario:

![image](https://user-images.githubusercontent.com/94720207/215276075-4e2f71c8-bca5-4c7c-a680-157b915c7898.png)

#### UI

1. `Policy & Objects` > `Schedules` > `Create New`

![image](https://user-images.githubusercontent.com/94720207/215276142-6514ccc3-efcf-4855-b0a1-2b70be6185bf.png)

2. Llenar formulario:

![image](https://user-images.githubusercontent.com/94720207/215278301-e7b53e79-5d38-4184-84be-4616f81dbada.png)

- Ahora ya se ve el `objeto` creado:

![image](https://user-images.githubusercontent.com/94720207/215278353-707d9501-e00a-4327-8510-349399537ee0.png)

3. Aplico el `objecto schedule` en la `policy` que tengo creada

![image](https://user-images.githubusercontent.com/94720207/215278607-732dbb45-b233-4be0-8f64-dc154d4a17ef.png)

- Así se ve ahora la `policy`:

![image](https://user-images.githubusercontent.com/94720207/215278697-b9a5409d-850d-4a30-bb3a-5d3be1599a3e.png)

- Como casualmente estoy haciendo esto en sábado, automáticamente me denegará el acceso completo a Internet (nisiquiera los servicios que tengo como `allow` en el `objeto de servicios`)

![image](https://user-images.githubusercontent.com/94720207/215278984-52a010ac-8fd2-4b05-9d5e-1f06caf30d3d.png)




## Crear object: `Internet Service Database`

- Este objeto si tiene por default una larga y muy útil lista de servicios predefinidos (también se pueden agregar nuevos manualmente).

- Existen servicios y aplicaciones de todo tipo como `ssh`, `TeamViewer`, `Telegram`, `Whatsapp`, `Facebook`, etc, etc. 

#### UI

1. `Policy & Objects` > `Schedules` 

![image](https://user-images.githubusercontent.com/94720207/215279672-55a6dc93-96ed-4536-aa1b-49b195cf1951.png)

![image](https://user-images.githubusercontent.com/94720207/215279616-0967cdee-afd1-4188-ac0e-5dc85c72741f.png)

2. Aplicarlo a una `policy`, en esta caso voy a crear una nueva que no sea la de Internet, donde únicamente niegue el acceso a `facebook`. 

    - Esto se aplica en la parte de `source` y `destination`

![image](https://user-images.githubusercontent.com/94720207/215280202-7b51d133-1e0b-45fb-b473-6056c036812d.png)

- Así se vería la nueva `policy`, sin embargo **AÚN NO FUNCIONARÍA Y AÚN PERMITIRÍA ACCESO A `FACEBOOK`**:

![image](https://user-images.githubusercontent.com/94720207/215282247-c4659136-7e73-4b18-9582-4a12dbb6b6f5.png)

![image](https://user-images.githubusercontent.com/94720207/215282019-f777970e-f23a-4bf9-99f9-58192d4f3b47.png)

- Debido a que FortiGate evalúa de arriba hacia abajo, estaría sería necesario colocarla arriba de la salida a Internet ;)

- Así se vería la nueva `policy` acomodada arriba, ahora si bloquearía facebook, mientras permite los objetos de `HTTP`, `HTTPS` y `DNS`, con un detemrinado `schedule` y `address` específica

![image](https://user-images.githubusercontent.com/94720207/215282421-a58fd15f-6858-4b84-b270-d2cb28339b99.png)

- Nota: En este ejemplo no me funcionó la policy de `facebook`, sin embargo, hay mejores manera de bloquear los servicios...

- OJO! _Esto también se podrá hacer más adelante en opciones de `security profiles > application control`, pero desde aquí FortiGate ya permite crear es tipo de reglas_

- En este momento regreso las políticas a unas mas permisivas para los próximos labs:

![image](https://user-images.githubusercontent.com/94720207/215283854-544ab730-d228-44dc-828e-1beacdaf29e5.png)



# FortiGate 7.0 - `Parte 8` - Routing: `Static Routes`

- Hay diferentes formas de utilizar rutas estáticas las cuales se verán a lo largo de este capítulo

- Para este laboratorio modificaré las conexiones, en lugar de que `SITE-A` y `SITE-B` se conecten vía Internet, tendrán una conexión directa. Por ejemplo, como cuando se conectan routers en Cisco CCNA ;)

- El Lab quedará así: 

![image](https://user-images.githubusercontent.com/94720207/215293953-295d056b-120f-4151-b505-8bdd99e57a58.png)

## Conexión directa entre `SITE-A` y `SITE-B`

- Básicamente solo es configurar la nueva interface y sus IPs... Yo utilicé el `Port 7`

#### UI

1. `Network` > `Interfaces` > `Port 7`

![image](https://user-images.githubusercontent.com/94720207/215294289-269fb505-6eb4-43f4-83e2-0be1a80e614e.png)

2. Llenar el formulario:

![image](https://user-images.githubusercontent.com/94720207/215294435-6c9e9c7d-dbb7-4846-af4b-b3eb4b401c25.png)

- Lo mismo se debe hacer para el `SITE-B`

- Cuando se termine se podrá hacer ping entre `SITE-A` y `SITE-B`:

````py
# Site-B --->>> Site-A

FortiGate-Fz3r0-Site-B # execute ping 172.66.66.1
PING 172.66.66.1 (172.66.66.1): 56 data bytes
64 bytes from 172.66.66.1: icmp_seq=0 ttl=255 time=4.0 ms 
64 bytes from 172.66.66.1: icmp_seq=1 ttl=255 time=0.4 ms
64 bytes from 172.66.66.1: icmp_seq=2 ttl=255 time=0.4 ms
64 bytes from 172.66.66.1: icmp_seq=3 ttl=255 time=35.7 ms
64 bytes from 172.66.66.1: icmp_seq=4 ttl=255 time=0.4 ms

--- 172.66.66.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 0.4/8.1/35.7 ms
````
````py
# Site-A --->>> Site-B

FortiGate-Fz3r0-Site-A # execute ping 172.66.66.2
PING 172.66.66.2 (172.66.66.2): 56 data bytes
64 bytes from 172.66.66.2: icmp_seq=0 ttl=255 time=0.9 ms
64 bytes from 172.66.66.2: icmp_seq=1 ttl=255 time=4.0 ms
64 bytes from 172.66.66.2: icmp_seq=2 ttl=255 time=0.4 ms
64 bytes from 172.66.66.2: icmp_seq=3 ttl=255 time=1.3 ms
64 bytes from 172.66.66.2: icmp_seq=4 ttl=255 time=0.5 ms

--- 172.66.66.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 0.4/1.4/4.0 ms

FortiGate-Fz3r0-Site-A # 
````

- **NOTA:** No obstante, **no se podría hacer ping hacia las PCs o Server**, ya que se necesita algún tipo de `routing` que pueda enrutar el tráfico, existen muchos tipos, pero ahora configuraré el más sencillo que son `static routes`.

- **Es decir, directamente 2 routers se pueden "ver" con tan solo configurar las IPs en su Network, pero para sus Neighbors remotos se necesita crear una ruta... Eso es el routing! ;)** _Esto se ve mucho...muchísimo! mas a fondo en Cisco CCNA_

![image](https://user-images.githubusercontent.com/94720207/215350504-3f0a3405-4888-4227-a326-98559fcf770b.png)





## Routing: Configuración de `Static Routes` entre `LANs remotas`

- Como se mencionó anteriormente y se ve en la última imagen ahora es necesario configurar las `rutas estáticas` para que se puedan comunicar ambos sitios, incluyendo las `LAN` tanto de `SITE-A` y `SITE-B`

#### UI

1. `Network` > `Static Routes` > `Create New`

![image](https://user-images.githubusercontent.com/94720207/215336847-8f3120ab-c3e9-4f39-bd48-813ba2c7384d.png)

2. Llenar el formulario:

    - `Gateway` = Es la interface adyacente del router que me servirá para crear la ruta, en este caso en el otro lado está el `FortiGate SITE-B` con el `Port 7` que tiene la IP `172.66.66.2`
    
    - `Destination` = Es la red de destino, se debe poner el `Network/Subnet ID` (por ejemplo la clásica `192.168.0.0/24`) 

![image](https://user-images.githubusercontent.com/94720207/215337712-2c3d6ea0-2d36-45b0-8474-b4da9701607c.png)

- Al final se verá la ruta creada (También se debe hacer lo mismo desde el `Site-B`)

![image](https://user-images.githubusercontent.com/94720207/215337944-48ee1518-4c08-48e4-ab13-c1a2b5d1930d.png)

![image](https://user-images.githubusercontent.com/94720207/215338474-ea875e62-f047-47ca-8ee9-ba00d12f4e72.png)

- OJO! Aquí aún no se puede hacer ping ni existe comunicación, es porque hay que crear una `policy`, de la misma manera que se hizo con la salida a Internet.

3. Crear `Firewall Policy` con los datos respectivos (en este caso lo dejaré todo en `all`, pero se puede ser más granular)

- `Incoming Interface` - Es la LAN, ya que es la ruta `desde` donde lo queremos enrutar

- `Outgoing Interface` - Es la interface donde está la salida a la ruta, en este caso `Port 7`

    - OJO!!! No se necesita `NAT` ya que los hosts buscarán una dirección "que no conocen" fuera de la red, es por eso deben "preguntan" al Forti por esa ruta. Ya que los FortiGate SI conocen las rutas a esas redes. 
    - Por ejemplo, `FortiGate A` le indica a `Windows Server` que la ruta hacia la `Work Station` es via `FortiGate B`

![image](https://user-images.githubusercontent.com/94720207/215338884-8a3bcf62-1626-4918-ae1d-32cc8526cf34.png)

- IMPORTANTE: Se ha creado la ruta de `ida`, pero también se debe configurar una ruta de `regreso`.

    - `Opción A` - Hacer exactamente lo mismo y crear otra policy pero cambiando de lado las interfaces. 
    - `Opción B` = `Clone Reverse` - Esto es más sencillo, solo es hacer click con botón derecho y clon reverse ;)

4. Crear `Firewall Policy` de reversa. Yo usaré la `Opción B`:

- OJO!!! Aquí hay que agregar un nuevo nombre después de clonar y activar la policy ya que viene desactivada por default!

- Lo mismo hacer en `Site-B`, al final quedará algo así:

![image](https://user-images.githubusercontent.com/94720207/215339270-37dfa1aa-2f88-464f-9783-30d4aa4ab8e0.png)

![image](https://user-images.githubusercontent.com/94720207/215339576-f9a1e140-c3ac-4cf3-ad46-a9035e910477.png)

![image](https://user-images.githubusercontent.com/94720207/215339837-65b33c90-9338-4c1f-adaa-68dc90050ac3.png)

- Ahora ya se puede hacer ping entre las `LANs` de ambos sitios, y tanto `Windows Server` como `Windows 7` hacen ping estando en diferentes Routers y LANs:

![image](https://user-images.githubusercontent.com/94720207/215340231-3a72f442-22d5-45c1-b2f2-87a3b786348a.png)

![image](https://user-images.githubusercontent.com/94720207/215340362-6af3bf5b-095f-47de-a32e-7cc0f4117115.png)

## Pro Config: `Objects` - Asignar objetos a cada `Dirección IP` como `variables`

- Una buena práctica y prolija para un óptimo funcionamiento y pensando a cambios a futuro es asignar a todas nuestras direcciones utlilizadas un objeto. 

- Veáse como una variable en programación, donde siempre a un string como `"suma_numero"` o un simple `i` nos puede servir de variable para guardar información y mandarla a llamar más adelante. 

- Del mismo modo es este concepto, así si en un futuro cambian las direcciones del otro gateway por ejemplo, solo tengamos que cambiar el contenido de la "variable" o mejor dicho `Address Object`.

#### UI

1. `Addresses` > `Create New` > `Address`

![image](https://user-images.githubusercontent.com/94720207/215343250-33ba63a5-8684-4d65-b4fe-1e35ab4ddd0e.png)

2. Llenar el formulario

    - OJO!!! Aquí se le enciende `Static route configuration` para permitirle ser usada en configuraciones de routing.

![image](https://user-images.githubusercontent.com/94720207/215343635-1444cd08-ac66-4bd5-afbe-2a993ab76d6c.png)

- Al final se verán algo así las direcciones:

![image](https://user-images.githubusercontent.com/94720207/215344168-775c3459-43e2-440c-811c-307726200aba.png)

3. Ahora solo es cuestión de modificar las salidas `all` por las direcciones específicas en la `policy de routing`

![image](https://user-images.githubusercontent.com/94720207/215344272-ff660e71-114e-4195-b034-17019f1239d9.png)

- Al final se verá algo así (hacer lo mismo en ambos sitios, de hecho son exactamente los mismos datos):

![image](https://user-images.githubusercontent.com/94720207/215344370-0c6d6aae-f33e-4985-81df-698beebb802b.png)

![image](https://user-images.githubusercontent.com/94720207/215344770-e3d7e2b5-bbcd-482c-8c3a-a96aced1f03a.png)

- Reviso que la comunicación siga exactamente igual:

![image](https://user-images.githubusercontent.com/94720207/215345018-c73b692a-a878-446c-b07a-79a0721183dc.png)

- Nota: También desde mi `Host Windows 7` ya puedo alcanzar la URL default del `Windows Server IIS` via `http` (`https` no es soportado en esta versión de prueba de FortiGate)

![image](https://user-images.githubusercontent.com/94720207/215345615-3b0ab4f9-edbb-4576-b98d-33cf0e5f2784.png)

- Al final se vería así la topología: 

![image](https://user-images.githubusercontent.com/94720207/215350642-8cd188c1-f375-4259-b48c-1b959689ba27.png)





## Routing: `Policy Route`

- Este tipo de políticas se utiliza para seleccionar los servicios, objetos, puertos, etc... que puede tener diferentes opciones de enrutamiento a `Destino-X` o `Destino-Y`

- Es decir, es un tipo de enrutamiento estático más especifico que permite especificar el tipo de tráfico y la ruta que tomará.

- Por ejemplo, si vuelvo a conctar `Puerto 2` y `Puerto 4` a las WANs (ISPs) de mis FortiGate, ahora tendré 2 salidas a algún `borde`:

    1. Uno será la `WAN / Internet` 
    2. Otro la `static route / LAN remota`

- Si yo quisiera que por ejemplo `http`, `https` y `dns` salieran por `Internet/WAN` pero los `ICMP` salieran por la ruta estática hacia exactamente el mismo destino, entonces para eso se utiliza una `policy route` ;) 

![image](https://user-images.githubusercontent.com/94720207/215351760-5c0a6f49-af7e-4e07-96e8-1d0d8b617b65.png)

## Policies: Creando `Policy Route`

1. `Network` > `Policy Routes` > `Create New`

![image](https://user-images.githubusercontent.com/94720207/215354759-661a7d67-61c7-4895-bcc9-d592a0fee494.png)

2. Llenar el formulario:

![image](https://user-images.githubusercontent.com/94720207/215355583-20952bff-5e48-4876-adcd-8fbf9448e5fa.png)

- Resultado:

![image](https://user-images.githubusercontent.com/94720207/215355699-bcc15db8-85d4-4dee-be62-295582404931.png)

- Así se ha indicado que hay una excepción al tráfico HTTP y cuando quiera ir al `Site B`, debe hacerlo por `Internet` (Puerto WAN)

- Nota: Este lab no tiene ruta desde Internet hacia cada uno de los sitios, pero se puede comprobar con wireshark capturando el trafico en cada Interface:

- Probando tráfico `TCP 80` desde `Puerto 4`:

![image](https://user-images.githubusercontent.com/94720207/215356457-03c990a5-a78e-44c1-91b2-fca491204e88.png)

- Probando tráfico `ICMP` desde `Puerto 7`:

![image](https://user-images.githubusercontent.com/94720207/215356729-67a5db4f-9de4-40ed-9f39-7bdcaeb97d34.png)

- Así se puede "separar" el tipo de tráfico en caso de tener **diferentes reutas hacia el mismo destino :D**



























































# FortiGate 7.0 - `Parte X` - CLI, Commands & Scripts

























---





---

### Layer 2 MAC Flooding & ARP Spoofing

- **Before anything else!**
    




# FortiGate 7.0 - `Parte X` - CLI, Commands & Scripts

## Super básicos:

- `?` - Da info en cualquier parte del comando

### `config` - Entrar a configurar



```py
# Entrar a config de interface

`config system interface`
```

### `get` - Muestra todo | Muestra objetos dinámicos

```py
get system interface
```

```py
# Obtener información detallada del FortiGate

get system status
```

````py
# Tener el status del rendimiento del equipo

get system performance status
````

### `show` - Muestra solo cambios manuales

````py
# Ver default y Config cambiada completa

show full-configuration
````

````py
# Ver información de las interfaces

show system interface
````

### `execute` - Ejecutar

- `ping`

````py
# Ping - Muestra las opciones de Ping

execute ping-options
````

````py
# Ping - Hace ping básico a una IP

execute ping 1.1.1.1
````

### `alias` - Muy similar a Linux

- Queda pendiente documentar, en resumen es un alias...

### `grep` - Muy similar a Linux

````py
# grep - Un grep medio armadón (-f contexto de configuración)

show | grep -f "MGMT"
````

### `contexto` - Trucos para saber ¿Dónde estoy? & ¿A dónde ir?

- Si abro la UI por web y entro a una pestaña y desde ahí abro el CLI, sabré exactamente en que `contexto` estaré en consola ;).




Show y get

- show muestra los cambios diferentes a los valores por defecto
- get muestra todos los valores




































---

<span align="center"> <p align="center"> ![giphy](https://user-images.githubusercontent.com/94720207/166587250-292d9a9f-e590-4c25-a678-d457e2268e85.gif) </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _I really hope this has helped someone to find an answer,_ </p> </span> 
<span align="center"> <p align="center"> _return the favor by making someone smile on a stormy day, and please..._ </p> </span> 
<span align="center"> <p align="center"> _don't forget to enjoy your days..._ </p> </span> 
<span align="center"> <p align="center"> _...It's getting dark... so dark..._ </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _I am [Fz3r0 💀](https://github.com/Fz3r0/) and the Sun no longer rises..._ </p> </span> 

---

## Recursos

- https://www.udemy.com/course/fortinet-7-de-principiante-a-experto

---

> ![hecho en mexico 5](https://user-images.githubusercontent.com/94720207/166068790-fa1f243d-2db9-4810-a6e4-eb3c4ad23700.png)
>
> _- Hecho en México - by [Fz3r0 💀](https://github.com/Fz3r0/)_  
>
> _"In the mist of the night you could see me come, where shadows move and Demons lie..."_ 


